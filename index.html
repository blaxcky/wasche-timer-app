<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wäsche-Timer</title>
    <link rel="manifest" href="data:application/json,{%22name%22:%22Wäsche-Timer%22,%22short_name%22:%22WäscheTimer%22,%22description%22:%22Verfolgen Sie die Trockenzeit Ihrer Wäsche am Wäscheständer%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23ffffff%22,%22theme_color%22:%22%232563eb%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232563eb'/%3E%3Cpath d='M30 35h40v30H30z' fill='white'/%3E%3Cpath d='M35 40h30v5H35z' fill='%232563eb'/%3E%3Cpath d='M35 50h30v5H35z' fill='%232563eb'/%3E%3Cpath d='M35 60h30v5H35z' fill='%232563eb'/%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232563eb'/%3E%3Cpath d='M30 35h40v30H30z' fill='white'/%3E%3Cpath d='M35 40h30v5H35z' fill='%232563eb'/%3E%3Cpath d='M35 50h30v5H35z' fill='%232563eb'/%3E%3Cpath d='M35 60h30v5H35z' fill='%232563eb'/%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Wäsche-Timer">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Verbesserte Touch-Targets */
        .touch-target {
            min-height: 48px;
            min-width: 48px;
        }
        
        /* Bessere Eingabefelder für Mobile */
        input[type="datetime-local"] {
            font-size: 16px; /* Verhindert Zoom auf iOS */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React Icons (simplified)
        const Clock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const Edit = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const CheckCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        );

        const LaundryTimerApp = () => {
            // Funktion zum Laden der Timer
            const getInitialTimers = () => {
                // In-memory storage für diese Demo
                return [];
            };

            const [timers, setTimers] = useState(getInitialTimers);
            const [newLoadName, setNewLoadName] = useState('');
            const [editingTimer, setEditingTimer] = useState(null);
            const [editDateTime, setEditDateTime] = useState('');
            
            // currentTime wird jede Sekunde aktualisiert, um die Timer-Anzeige zu aktualisieren
            const [currentTime, setCurrentTime] = useState(new Date());

            // Effekt zum Aktualisieren der currentTime jede Sekunde
            useEffect(() => {
                const interval = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            // Neue Wäscheladung hinzufügen und direkt starten
            const addNewLoad = () => {
                if (newLoadName.trim()) {
                    const newTimer = {
                        id: Date.now(),
                        name: newLoadName,
                        startTime: new Date(),
                        completedElapsedTime: null,
                        isCompleted: false
                    };
                    setTimers([...timers, newTimer]);
                    setNewLoadName('');
                }
            };

            // Startzeit bearbeiten
            const startEditTimer = (id) => {
                const timer = timers.find(t => t.id === id);
                if (timer) {
                    // Konvertiere das Datum in das für datetime-local benötigte Format
                    const localDateTime = new Date(timer.startTime.getTime() - timer.startTime.getTimezoneOffset() * 60000)
                        .toISOString().slice(0, 16);
                    setEditingTimer(id);
                    setEditDateTime(localDateTime);
                }
            };

            // Startzeit speichern
            const saveEditTimer = () => {
                if (editingTimer && editDateTime) {
                    const newStartTime = new Date(editDateTime);
                    setTimers(prevTimers =>
                        prevTimers.map(timer => {
                            if (timer.id === editingTimer) {
                                return {
                                    ...timer,
                                    startTime: newStartTime
                                };
                            }
                            return timer;
                        })
                    );
                    setEditingTimer(null);
                    setEditDateTime('');
                }
            };

            // Bearbeitung abbrechen
            const cancelEditTimer = () => {
                setEditingTimer(null);
                setEditDateTime('');
            };

            // Timer als fertig markieren
            const completeTimer = (id) => {
                const timer = timers.find(t => t.id === id);
                const confirmMessage = `Möchten Sie "${timer.name}" als fertig markieren?\n\nDer Timer wird gestoppt und als abgeschlossen markiert.`;
                
                if (window.confirm(confirmMessage)) {
                    setTimers(prevTimers =>
                        prevTimers.map(timer => {
                            if (timer.id === id) {
                                const finalElapsedTime = Math.floor((currentTime.getTime() - timer.startTime.getTime()) / 1000);
                                return {
                                    ...timer,
                                    isCompleted: true,
                                    completedElapsedTime: finalElapsedTime
                                };
                            }
                            return timer;
                        })
                    );
                }
            };

            // Timer löschen
            const deleteTimer = (id) => {
                const timer = timers.find(t => t.id === id);
                const confirmMessage = `Möchten Sie "${timer.name}" wirklich löschen?\n\nDiese Aktion kann nicht rückgängig gemacht werden.`;
                
                if (window.confirm(confirmMessage)) {
                    setTimers(prevTimers => prevTimers.filter(timer => timer.id !== id));
                }
            };

            // Zeit formatieren mit Tagen, Stunden, Minuten und Sekunden
            const formatTime = (seconds) => {
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                
                if (days > 0) {
                    return `${days}d ${hours}h ${minutes}m ${secs}s`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m ${secs}s`;
                }
                return `${minutes}m ${secs}s`;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-3 sm:p-4">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-6 sm:mb-8">
                            <h1 className="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-2 sm:gap-3">
                                <Clock size={32} className="text-blue-600 sm:w-10 sm:h-10" />
                                Wäsche-Timer
                            </h1>
                            <p className="text-gray-600 text-sm sm:text-base px-4">Verfolgen Sie die Trockenzeit Ihrer Wäsche am Wäscheständer</p>
                        </div>

                        {/* Neue Wäscheladung hinzufügen */}
                        <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6">
                            <h2 className="text-lg sm:text-xl font-semibold mb-4 text-gray-800">Neue Wäscheladung</h2>
                            <div className="flex flex-col gap-3 sm:flex-row">
                                <input
                                    type="text"
                                    value={newLoadName}
                                    onChange={(e) => setNewLoadName(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addNewLoad()}
                                    placeholder="z.B. Buntwäsche, Handtücher, Bettwäsche..."
                                    className="flex-1 px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                                <button
                                    onClick={addNewLoad}
                                    className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 transition-colors flex items-center justify-center gap-2 font-medium touch-target"
                                >
                                    <Plus size={20} />
                                    Starten
                                </button>
                            </div>
                        </div>

                        {/* Aktive Timer */}
                        <div className="space-y-4">
                            {timers.map(timer => {
                                const currentElapsedTime = timer.isCompleted
                                    ? timer.completedElapsedTime
                                    : Math.floor((currentTime.getTime() - timer.startTime.getTime()) / 1000);

                                // 3 Tage = 259200 Sekunden
                                const targetSeconds = 3 * 24 * 60 * 60;
                                const progressPercentage = Math.min((currentElapsedTime / targetSeconds) * 100, 100);
                                const isTargetReached = currentElapsedTime >= targetSeconds;

                                return (
                                    <div
                                        key={timer.id}
                                        className={`relative overflow-hidden bg-white rounded-xl shadow-lg transition-all ${
                                            timer.isCompleted ? 'opacity-75' : ''
                                        }`}
                                    >
                                        {/* Fortschrittsbalken Hintergrund */}
                                        <div 
                                            className={`absolute inset-0 transition-all duration-1000 ${
                                                isTargetReached 
                                                    ? 'bg-gradient-to-r from-green-100 to-green-200' 
                                                    : 'bg-gradient-to-r from-blue-50 to-blue-100'
                                            }`}
                                            style={{ 
                                                width: `${progressPercentage}%`,
                                                opacity: 0.6
                                            }}
                                        />
                                        
                                        {/* Inhalt */}
                                        <div className="relative z-10 p-4 sm:p-6">
                                            {/* Mobile Layout: Stacked */}
                                            <div className="block sm:hidden">
                                                {/* Header mit Namen und Status */}
                                                <div className="flex items-center justify-between mb-3">
                                                    <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2 flex-1 min-w-0">
                                                        <span className="truncate">{timer.name}</span>
                                                        {timer.isCompleted && (
                                                            <CheckCircle className="text-green-600 flex-shrink-0" size={18} />
                                                        )}
                                                    </h3>
                                                    {isTargetReached && !timer.isCompleted && (
                                                        <span className="text-green-600 font-bold text-sm whitespace-nowrap">✓ 3 TAGE</span>
                                                    )}
                                                </div>
                                                
                                                {/* Timer Display - Zentral und groß */}
                                                <div className="text-center mb-4">
                                                    <div className={`text-3xl sm:text-4xl font-mono font-bold mb-1 ${
                                                        isTargetReached ? 'text-green-700' : 'text-gray-800'
                                                    }`}>
                                                        {formatTime(currentElapsedTime)}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        {timer.isCompleted ? 'Abgeschlossen' : 'Läuft...'}
                                                    </div>
                                                </div>

                                                {/* Startzeit */}
                                                <div className="mb-4">
                                                    {editingTimer === timer.id ? (
                                                        <div className="space-y-3">
                                                            <input
                                                                type="datetime-local"
                                                                value={editDateTime}
                                                                onChange={(e) => setEditDateTime(e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            />
                                                            <div className="flex gap-2">
                                                                <button
                                                                    onClick={saveEditTimer}
                                                                    className="flex-1 py-2 bg-green-100 text-green-700 rounded-lg font-medium hover:bg-green-200 transition-colors touch-target"
                                                                >
                                                                    Speichern
                                                                </button>
                                                                <button
                                                                    onClick={cancelEditTimer}
                                                                    className="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors touch-target"
                                                                >
                                                                    Abbrechen
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="flex items-center justify-between">
                                                            <div className="text-sm text-gray-500 flex-1">
                                                                <div>Gestartet:</div>
                                                                <div className="font-medium text-gray-700">
                                                                    {timer.startTime.toLocaleDateString('de-DE', { 
                                                                        day: '2-digit', 
                                                                        month: '2-digit', 
                                                                        year: 'numeric' 
                                                                    })}
                                                                </div>
                                                                <div className="font-medium text-gray-700">
                                                                    {timer.startTime.toLocaleTimeString('de-DE', { 
                                                                        hour: '2-digit', 
                                                                        minute: '2-digit' 
                                                                    })}
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => startEditTimer(timer.id)}
                                                                className="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors touch-target"
                                                                title="Startzeit bearbeiten"
                                                            >
                                                                <Edit size={18} />
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Fortschrittsanzeige */}
                                                <div className="mb-4">
                                                    <div className="flex items-center gap-3 mb-2">
                                                        <div className="flex-1 bg-gray-200 rounded-full h-3">
                                                            <div 
                                                                className={`h-3 rounded-full transition-all duration-1000 ${
                                                                    isTargetReached ? 'bg-green-500' : 'bg-blue-500'
                                                                }`}
                                                                style={{ width: `${progressPercentage}%` }}
                                                            />
                                                        </div>
                                                        <span className="text-sm font-medium min-w-fit">
                                                            {Math.round(progressPercentage)}%
                                                        </span>
                                                    </div>
                                                    <div className="text-center text-sm text-gray-600">
                                                        {isTargetReached 
                                                            ? '🎉 Ziel erreicht!' 
                                                            : `Noch ${formatTime(targetSeconds - currentElapsedTime)} bis zum 3-Tage-Ziel`
                                                        }
                                                    </div>
                                                </div>

                                                {/* Action Buttons */}
                                                <div className="flex gap-3">
                                                    {!timer.isCompleted && (
                                                        <button
                                                            onClick={() => completeTimer(timer.id)}
                                                            className="flex-1 py-3 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 active:bg-blue-300 transition-colors flex items-center justify-center gap-2 font-medium touch-target"
                                                        >
                                                            <CheckCircle size={20} />
                                                            Fertig
                                                        </button>
                                                    )}
                                                    
                                                    <button
                                                        onClick={() => deleteTimer(timer.id)}
                                                        className={`py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 active:bg-red-300 transition-colors flex items-center justify-center gap-2 font-medium touch-target ${
                                                            timer.isCompleted ? 'flex-1' : 'px-4'
                                                        }`}
                                                    >
                                                        <Trash2 size={20} />
                                                        {timer.isCompleted ? 'Löschen' : ''}
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Desktop Layout: Horizontal */}
                                            <div className="hidden sm:flex items-center justify-between gap-6">
                                                <div className="flex-1 min-w-0">
                                                    <h3 className="text-lg font-semibold text-gray-800 mb-1 flex items-center gap-2">
                                                        <span className="truncate">{timer.name}</span>
                                                        {timer.isCompleted && (
                                                            <CheckCircle className="text-green-600 flex-shrink-0" size={20} />
                                                        )}
                                                        {isTargetReached && !timer.isCompleted && (
                                                            <span className="text-green-600 font-bold text-sm flex-shrink-0">✓ 3 TAGE</span>
                                                        )}
                                                    </h3>
                                                    <p className="text-sm text-gray-500 mb-2">
                                                        {editingTimer === timer.id ? (
                                                            <div className="flex gap-2 items-center">
                                                                <input
                                                                    type="datetime-local"
                                                                    value={editDateTime}
                                                                    onChange={(e) => setEditDateTime(e.target.value)}
                                                                    className="px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                />
                                                                <div className="flex gap-1">
                                                                    <button
                                                                        onClick={saveEditTimer}
                                                                        className="px-3 py-1 bg-green-100 text-green-600 rounded text-sm hover:bg-green-200 transition-colors touch-target"
                                                                    >
                                                                        ✓
                                                                    </button>
                                                                    <button
                                                                        onClick={cancelEditTimer}
                                                                        className="px-3 py-1 bg-gray-100 text-gray-600 rounded text-sm hover:bg-gray-200 transition-colors touch-target"
                                                                    >
                                                                        ✕
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <span>
                                                                Gestartet: {timer.startTime.toLocaleString('de-DE')}
                                                                <button
                                                                    onClick={() => startEditTimer(timer.id)}
                                                                    className="ml-2 p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors touch-target"
                                                                    title="Startzeit bearbeiten"
                                                                >
                                                                    <Edit size={16} />
                                                                </button>
                                                            </span>
                                                        )}
                                                    </p>
                                                    {/* Fortschrittsanzeige */}
                                                    <div className="text-sm text-gray-600">
                                                        <div className="flex items-center gap-2">
                                                            <div className="flex-1 bg-gray-200 rounded-full h-2">
                                                                <div 
                                                                    className={`h-2 rounded-full transition-all duration-1000 ${
                                                                        isTargetReached ? 'bg-green-500' : 'bg-blue-500'
                                                                    }`}
                                                                    style={{ width: `${progressPercentage}%` }}
                                                                />
                                                            </div>
                                                            <span className="text-xs font-medium min-w-fit">
                                                                {Math.round(progressPercentage)}%
                                                            </span>
                                                        </div>
                                                        <div className="mt-1 text-xs">
                                                            {isTargetReached 
                                                                ? '🎉 Ziel erreicht!' 
                                                                : `Noch ${formatTime(targetSeconds - currentElapsedTime)} bis zum 3-Tage-Ziel`
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="text-center">
                                                    <div className={`text-2xl md:text-3xl font-mono font-bold ${
                                                        isTargetReached ? 'text-green-700' : 'text-gray-800'
                                                    }`}>
                                                        {formatTime(currentElapsedTime)}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        {timer.isCompleted ? 'Abgeschlossen' : 'Läuft...'}
                                                    </div>
                                                </div>

                                                <div className="flex gap-2">
                                                    {!timer.isCompleted && (
                                                        <button
                                                            onClick={() => completeTimer(timer.id)}
                                                            className="p-3 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 active:bg-blue-300 transition-colors touch-target"
                                                            title="Als fertig markieren"
                                                        >
                                                            <CheckCircle size={20} />
                                                        </button>
                                                    )}
                                                    
                                                    <button
                                                        onClick={() => deleteTimer(timer.id)}
                                                        className="p-3 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 active:bg-red-300 transition-colors touch-target"
                                                        title="Timer löschen"
                                                    >
                                                        <Trash2 size={20} />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {timers.length === 0 && (
                            <div className="text-center py-12">
                                <Clock className="mx-auto text-gray-400 mb-4" size={64} />
                                <h3 className="text-xl font-semibold text-gray-600 mb-2">
                                    Noch keine Wäsche am Trocknen
                                </h3>
                                <p className="text-gray-500 px-4">
                                    Fügen Sie Ihre erste Wäscheladung hinzu, um mit dem Tracking zu beginnen.
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<LaundryTimerApp />, document.getElementById('root'));

        // Service Worker registrieren
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,const CACHE_NAME="laundry-timer-v1";const urlsToCache=["/"];self.addEventListener("install",event=>{event.waitUntil(caches.open(CACHE_NAME).then(cache=>cache.addAll(urlsToCache)))});self.addEventListener("fetch",event=>{event.respondWith(caches.match(event.request).then(response=>{if(response){return response}return fetch(event.request)}))});')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }
    </script>
</body>
</html>
