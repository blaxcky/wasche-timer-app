<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W√§sche-Timer</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="W√§sche-Timer">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .touch-target {
            min-height: 48px;
            min-width: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        input[type="datetime-local"] {
            font-size: 16px;
        }

        .view-toggle-btn {
            transition: all 0.2s ease;
        }

        .view-toggle-btn:hover {
            transform: translateY(-1px);
        }

        .compact-timer-card {
            transition: all 0.3s ease;
        }

        .compact-timer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .options-menu {
            z-index: 50;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React Icons (simplified)
        const Clock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const Edit = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const CheckCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17,8 12,3 7,8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const MoreVertical = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="12" cy="5" r="1"/>
                <circle cx="12" cy="19" r="1"/>
            </svg>
        );

        const ChevronLeft = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="15,18 9,12 15,6"/>
            </svg>
        );

        const ChevronRight = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9,18 15,12 9,6"/>
            </svg>
        );

        const ScrollPicker = ({ values, selected, onChange, format }) => {
            const containerRef = React.useRef(null);
            const itemHeight = 40;
            const selectedIndex = values.indexOf(selected);

            useEffect(() => {
                if (containerRef.current) {
                    containerRef.current.scrollTop = selectedIndex * itemHeight;
                }
            }, []);

            const handleScroll = (e) => {
                const scrollTop = e.target.scrollTop;
                const index = Math.round(scrollTop / itemHeight);
                if (index >= 0 && index < values.length && values[index] !== selected) {
                    onChange(values[index]);
                }
            };

            return (
                <div
                    ref={containerRef}
                    onScroll={handleScroll}
                    className="h-32 overflow-y-auto snap-y snap-mandatory scrollbar-hide relative z-10"
                    style={{ scrollSnapType: 'y mandatory' }}
                >
                    <div style={{ height: itemHeight }} />
                    {values.map((val, idx) => (
                        <div
                            key={val}
                            onClick={() => {
                                onChange(val);
                                if (containerRef.current) {
                                    containerRef.current.scrollTo({ top: idx * itemHeight, behavior: 'smooth' });
                                }
                            }}
                            className={`h-10 flex items-center justify-center text-xl cursor-pointer snap-center transition-colors ${
                                val === selected ? 'text-blue-700 font-bold text-2xl' : 'text-gray-300'
                            }`}
                            style={{ scrollSnapAlign: 'center' }}
                        >
                            {format ? format(val) : val}
                        </div>
                    ))}
                    <div style={{ height: itemHeight }} />
                </div>
            );
        };

        const DateTimePicker = ({ value, onChange, onClose }) => {
            const dateValue = value ? new Date(value) : new Date();
            const [viewDate, setViewDate] = useState(new Date(dateValue.getFullYear(), dateValue.getMonth(), 1));
            const [selectedDate, setSelectedDate] = useState(dateValue);
            const [hours, setHours] = useState(dateValue.getHours());
            const [minutes, setMinutes] = useState(dateValue.getMinutes());

            const weekDays = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];

            const hoursArray = Array.from({ length: 24 }, (_, i) => i);
            const minutesArray = Array.from({ length: 60 }, (_, i) => i);

            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const days = [];

                let startDay = firstDay.getDay() - 1;
                if (startDay === -1) startDay = 6;

                for (let i = startDay - 1; i >= 0; i--) {
                    const d = new Date(year, month, -i);
                    days.push({ date: d, currentMonth: false });
                }

                for (let i = 1; i <= lastDay.getDate(); i++) {
                    days.push({ date: new Date(year, month, i), currentMonth: true });
                }

                const remaining = 42 - days.length;
                for (let i = 1; i <= remaining; i++) {
                    days.push({ date: new Date(year, month + 1, i), currentMonth: false });
                }

                return days;
            };

            const isSameDay = (d1, d2) => {
                return d1.getDate() === d2.getDate() &&
                       d1.getMonth() === d2.getMonth() &&
                       d1.getFullYear() === d2.getFullYear();
            };

            const handleDayClick = (day) => {
                setSelectedDate(day.date);
            };

            const handleConfirm = () => {
                const result = new Date(selectedDate);
                result.setHours(hours);
                result.setMinutes(minutes);
                result.setSeconds(0);
                const localDateTime = new Date(result.getTime() - result.getTimezoneOffset() * 60000)
                    .toISOString().slice(0, 16);
                onChange(localDateTime);
                onClose();
            };

            const prevMonth = () => {
                setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1));
            };

            const nextMonth = () => {
                setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1));
            };

            const days = getDaysInMonth(viewDate);
            const formatNum = (n) => n.toString().padStart(2, '0');

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full overflow-hidden">
                        <div className="bg-blue-600 text-white p-4">
                            <div className="text-sm opacity-80">Ausgew√§hlt</div>
                            <div className="text-xl font-semibold">
                                {selectedDate.toLocaleDateString('de-DE', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
                            </div>
                            <div className="text-lg">{formatNum(hours)}:{formatNum(minutes)} Uhr</div>
                        </div>

                        <div className="p-4">
                            <div className="flex items-center justify-between mb-4">
                                <button onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-full">
                                    <ChevronLeft size={20} />
                                </button>
                                <span className="font-semibold">
                                    {monthNames[viewDate.getMonth()]} {viewDate.getFullYear()}
                                </span>
                                <button onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-full">
                                    <ChevronRight size={20} />
                                </button>
                            </div>

                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {weekDays.map(day => (
                                    <div key={day} className="text-center text-xs font-semibold text-gray-500 py-2">
                                        {day}
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-cols-7 gap-1">
                                {days.map((day, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => handleDayClick(day)}
                                        className={`p-2 text-sm rounded-full transition-colors ${
                                            !day.currentMonth ? 'text-gray-300' :
                                            isSameDay(day.date, selectedDate) ? 'bg-blue-600 text-white' :
                                            isSameDay(day.date, new Date()) ? 'bg-blue-100 text-blue-600' :
                                            'hover:bg-gray-100'
                                        }`}
                                    >
                                        {day.date.getDate()}
                                    </button>
                                ))}
                            </div>

                            <div className="mt-4 pt-4 border-t">
                                <div className="flex items-center justify-center gap-4">
                                    <div className="relative w-16 h-32 overflow-hidden">
                                        <div className="absolute inset-x-0 top-1/2 -translate-y-1/2 h-10 bg-blue-50 rounded-lg pointer-events-none z-0" />
                                        <ScrollPicker
                                            values={hoursArray}
                                            selected={hours}
                                            onChange={setHours}
                                            format={formatNum}
                                        />
                                    </div>
                                    <span className="text-2xl font-bold text-gray-400">:</span>
                                    <div className="relative w-16 h-32 overflow-hidden">
                                        <div className="absolute inset-x-0 top-1/2 -translate-y-1/2 h-10 bg-blue-50 rounded-lg pointer-events-none z-0" />
                                        <ScrollPicker
                                            values={minutesArray}
                                            selected={minutes}
                                            onChange={setMinutes}
                                            format={formatNum}
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="flex border-t">
                            <button
                                onClick={onClose}
                                className="flex-1 px-4 py-3 text-gray-600 hover:bg-gray-50 font-medium"
                            >
                                Abbrechen
                            </button>
                            <button
                                onClick={handleConfirm}
                                className="flex-1 px-4 py-3 text-blue-600 hover:bg-blue-50 font-medium border-l"
                            >
                                OK
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        const LaundryTimerApp = () => {

            const getInitialTimers = () => {
                try {
                    const storedTimers = localStorage.getItem('laundryTimers');
                    if (storedTimers) {
                        return JSON.parse(storedTimers).map(timer => ({
                            ...timer,
                            startTime: new Date(timer.startTime)
                        }));
                    }
                } catch (e) {
                    console.error("Fehler beim Laden der Timer aus localStorage:", e);
                }
                return [];
            };


            const [timers, setTimers] = useState(getInitialTimers);
            const [newLoadName, setNewLoadName] = useState('');
            const [editingTimer, setEditingTimer] = useState(null);
            const [editDateTime, setEditDateTime] = useState('');
            const [showDatePicker, setShowDatePicker] = useState(false);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [showOptionsMenu, setShowOptionsMenu] = useState(false);
            const [washingMachineEndTime, setWashingMachineEndTime] = useState(() => {
                const stored = localStorage.getItem('washingMachineEndTime');
                return stored ? new Date(stored) : null;
            });
            const [showWashingTimeSelect, setShowWashingTimeSelect] = useState(false);
            const [customWashingMinutes, setCustomWashingMinutes] = useState(170);

            useEffect(() => {
                localStorage.setItem('laundryTimers', JSON.stringify(timers));
            }, [timers]);

            useEffect(() => {
                if (washingMachineEndTime) {
                    localStorage.setItem('washingMachineEndTime', washingMachineEndTime.toISOString());
                } else {
                    localStorage.removeItem('washingMachineEndTime');
                }
            }, [washingMachineEndTime]);

            const startWashingMachine = (minutes = 170) => {
                const endTime = new Date(Date.now() + minutes * 60 * 1000);
                setWashingMachineEndTime(endTime);
                setShowWashingTimeSelect(false);
            };

            const stopWashingMachine = () => {
                setWashingMachineEndTime(null);
            };

            const getWashingMachineRemaining = () => {
                if (!washingMachineEndTime) return null;
                const remaining = Math.max(0, Math.floor((washingMachineEndTime.getTime() - currentTime.getTime()) / 1000));
                return remaining;
            };

            const washingRemaining = getWashingMachineRemaining();
            const isWashingDone = washingRemaining === 0 && washingMachineEndTime;


            useEffect(() => {
                const interval = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            const addNewLoad = () => {
                if (newLoadName.trim()) {
                    const newTimer = {
                        id: Date.now(),
                        name: newLoadName,
                        startTime: new Date()
                    };
                    setTimers([...timers, newTimer]);
                    setNewLoadName('');
                }
            };

            const startEditTimer = (id) => {
                const timer = timers.find(t => t.id === id);
                if (timer) {
                    const localDateTime = new Date(timer.startTime.getTime() - timer.startTime.getTimezoneOffset() * 60000)
                        .toISOString().slice(0, 16);
                    setEditingTimer(id);
                    setEditDateTime(localDateTime);
                }
            };

            const saveEditTimer = () => {
                if (editingTimer && editDateTime) {
                    const newStartTime = new Date(editDateTime);
                    setTimers(prevTimers =>
                        prevTimers.map(timer => {
                            if (timer.id === editingTimer) {
                                return {
                                    ...timer,
                                    startTime: newStartTime
                                };
                            }
                            return timer;
                        })
                    );
                    setEditingTimer(null);
                    setEditDateTime('');
                    setShowDatePicker(false);
                }
            };

            const cancelEditTimer = () => {
                setEditingTimer(null);
                setEditDateTime('');
                setShowDatePicker(false);
            };


            const deleteTimer = (id) => {
                const timerToDelete = timers.find(t => t.id === id);
                const confirmMessage = `M√∂chten Sie "${timerToDelete.name}" wirklich l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden.`;

                if (window.confirm(confirmMessage)) {
                    setTimers(prevTimers => prevTimers.filter(timer => timer.id !== id));
                }
            };

            const saveTimersToFile = async () => {
                try {
                    if ('showSaveFilePicker' in window) {
                        const fileHandle = await window.showSaveFilePicker({
                            suggestedName: `wasche-timer-backup-${new Date().toISOString().split('T')[0]}.json`,
                            types: [{
                                description: 'W√§sche-Timer Backup',
                                accept: { 'application/json': ['.json'] }
                            }]
                        });
                        
                        const writable = await fileHandle.createWritable();
                        await writable.write(JSON.stringify(timers, null, 2));
                        await writable.close();
                        
                        alert('Timer erfolgreich gespeichert!');
                    } else {
                        const blob = new Blob([JSON.stringify(timers, null, 2)], {type: 'application/json'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `wasche-timer-backup-${new Date().toISOString().split('T')[0]}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        console.error('Fehler beim Speichern:', error);
                        alert('Fehler beim Speichern der Timer-Daten');
                    }
                }
            };

            const loadTimersFromFile = async () => {
                try {
                    let file;
                    
                    if ('showOpenFilePicker' in window) {
                        const [fileHandle] = await window.showOpenFilePicker({
                            types: [{
                                description: 'W√§sche-Timer Backup',
                                accept: { 'application/json': ['.json'] }
                            }]
                        });
                        file = await fileHandle.getFile();
                    } else {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '.json';
                        input.onchange = async (e) => {
                            file = e.target.files[0];
                            if (file) {
                                await processImportedFile(file);
                            }
                        };
                        input.click();
                        return;
                    }
                    
                    await processImportedFile(file);
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        console.error('Fehler beim Laden:', error);
                        alert('Fehler beim Laden der Timer-Daten');
                    }
                }
            };

            const processImportedFile = async (file) => {
                try {
                    const contents = await file.text();
                    const importedTimers = JSON.parse(contents);
                    
                    if (!Array.isArray(importedTimers)) {
                        throw new Error('Ung√ºltiges Dateiformat');
                    }
                    
                    const processedTimers = importedTimers.map(timer => ({
                        ...timer,
                        startTime: new Date(timer.startTime)
                    }));
                    
                    const confirmMessage = `${importedTimers.length} Timer gefunden.\n\nM√∂chten Sie diese importieren?\n\n‚ö†Ô∏è Achtung: Ihre aktuellen Timer werden ersetzt!`;
                    
                    if (window.confirm(confirmMessage)) {
                        setTimers(processedTimers);
                        alert('Timer erfolgreich importiert!');
                    }
                } catch (error) {
                    console.error('Fehler beim Verarbeiten der Datei:', error);
                    alert('Ung√ºltige Timer-Datei. Bitte √ºberpr√ºfen Sie das Dateiformat.');
                }
            };

            const formatTime = (totalSeconds, showSeconds = true) => {
                if (totalSeconds < 0) totalSeconds = 0;

                const days = Math.floor(totalSeconds / 86400);
                const hours = Math.floor((totalSeconds % 86400) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const secs = totalSeconds % 60;

                let parts = [];

                if (showSeconds) {
                    if (days > 0) {
                        parts.push(`${days}d`);
                        parts.push(`${hours}h`);
                        parts.push(`${minutes}m`);
                        parts.push(`${secs}s`);
                    } else if (hours > 0) {
                        parts.push(`${hours}h`);
                        parts.push(`${minutes}m`);
                        parts.push(`${secs}s`);
                    } else if (minutes > 0) {
                        parts.push(`${minutes}m`);
                        parts.push(`${secs}s`);
                    } else {
                        parts.push(`${secs}s`);
                    }
                } else {
                    if (days > 0) {
                        parts.push(`${days}d`);
                        parts.push(`${hours}h`);
                    } else if (hours > 0) {
                        parts.push(`${hours}h`);
                    } else if (minutes > 0) {
                        parts.push(`${minutes}m`);
                    } else {
                        parts.push(`0m`);
                    }
                }

                if (parts.length === 0) {
                    return showSeconds ? "0s" : "0m";
                }

                return parts.join(' ');
            };

            const sortedTimers = timers
                .slice()
                .sort((a, b) => a.startTime.getTime() - b.startTime.getTime());

            const renderCompactTimer = (timer) => {
                const currentElapsedTime = Math.floor((currentTime.getTime() - timer.startTime.getTime()) / 1000);
                const targetSeconds = 3 * 24 * 60 * 60;
                const progressPercentage = Math.min((currentElapsedTime / targetSeconds) * 100, 100);
                const isTargetReached = currentElapsedTime >= targetSeconds;
                const isEditing = editingTimer === timer.id;

                if (isEditing) {
                    return (
                        <div
                            key={timer.id}
                            className="compact-timer-card bg-white rounded-lg shadow-md p-4 border-l-4 border-yellow-500"
                        >
                            <div className="space-y-3">
                                <h3 className="text-lg font-semibold text-gray-800">
                                    {timer.name}
                                </h3>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Startzeit √§ndern:
                                    </label>
                                    <button
                                        onClick={() => setShowDatePicker(true)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        {editDateTime ? (
                                            <span>
                                                {new Date(editDateTime).toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })} - {new Date(editDateTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                                            </span>
                                        ) : (
                                            <span className="text-gray-400">Datum & Zeit w√§hlen...</span>
                                        )}
                                    </button>
                                </div>

                                <div className="flex gap-2 pt-2">
                                    <button
                                        onClick={saveEditTimer}
                                        className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"
                                    >
                                        Speichern
                                    </button>
                                    <button
                                        onClick={cancelEditTimer}
                                        className="flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium"
                                    >
                                        Abbrechen
                                    </button>
                                </div>
                            </div>

                            {showDatePicker && (
                                <DateTimePicker
                                    value={editDateTime}
                                    onChange={(val) => setEditDateTime(val)}
                                    onClose={() => setShowDatePicker(false)}
                                />
                            )}
                        </div>
                    );
                }

                return (
                    <div
                        key={timer.id}
                        className={`compact-timer-card bg-white rounded-lg shadow-md p-4 border-l-4 ${
                            isTargetReached ? 'border-green-500' : 'border-blue-500'
                        }`}
                    >
                        <div className="flex items-center justify-between">
                            <div className="flex-1 min-w-0">
                                <h3 className="text-lg font-semibold text-gray-800 truncate pr-2">
                                    {timer.name}
                                </h3>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className={`text-sm font-mono font-bold ${
                                        isTargetReached ? 'text-green-700' : 'text-blue-600'
                                    }`}>
                                        {formatTime(currentElapsedTime)}
                                    </span>
                                    {isTargetReached && (
                                        <span className="text-green-600 text-xs font-bold">‚úì 3T</span>
                                    )}
                                </div>
                                <div className="mt-2">
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div
                                            className={`h-2 rounded-full transition-all duration-1000 ${
                                                isTargetReached ? 'bg-green-500' : 'bg-blue-500'
                                            }`}
                                            style={{ width: `${progressPercentage}%` }}
                                        />
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        {Math.round(progressPercentage)}% - {
                                            isTargetReached 
                                                ? 'Ziel erreicht!' 
                                                : `Noch ${formatTime(Math.max(0, targetSeconds - currentElapsedTime), false)}`
                                        }
                                    </div>
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                    Seit: {timer.startTime.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' })} {timer.startTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                            </div>
                            <div className="flex flex-col gap-1 ml-2">
                                <button
                                    onClick={() => startEditTimer(timer.id)}
                                    className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors touch-target"
                                    title="Startzeit bearbeiten"
                                >
                                    <Edit size={18} />
                                </button>
                                <button
                                    onClick={() => deleteTimer(timer.id)}
                                    className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors touch-target"
                                    title="Timer l√∂schen"
                                >
                                    <Trash2 size={18} />
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };


           return (
               <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-3 sm:p-4 pb-20">
                   <div className="max-w-4xl mx-auto">
                       {/* Header */}
                       <div className="text-center mb-6 sm:mb-8 relative">
                           <h1 className="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-2 sm:gap-3">
                               <Clock size={32} className="text-blue-600 sm:w-10 sm:h-10" />
                               W√§sche-Timer
                           </h1>
                           <p className="text-gray-600 text-sm sm:text-base px-4">Verfolgen Sie die Trockenzeit Ihrer W√§sche am W√§schest√§nder</p>
                           
                           {/* Backup-Men√º */}
                           <div className="absolute top-0 right-0">
                               <div className="relative">
                                   <button
                                       onClick={() => setShowOptionsMenu(!showOptionsMenu)}
                                       className="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-all touch-target"
                                       title="Backup-Optionen"
                                   >
                                       <MoreVertical size={16} />
                                   </button>
                                   
                                   {showOptionsMenu && (
                                       <>
                                           <div 
                                               className="fixed inset-0" 
                                               onClick={() => setShowOptionsMenu(false)}
                                           ></div>
                                           <div className="absolute top-12 right-0 bg-white rounded-lg shadow-xl border border-gray-200 py-2 min-w-48 options-menu">
                                               {timers.length > 0 && (
                                                   <button
                                                       onClick={() => {
                                                           saveTimersToFile();
                                                           setShowOptionsMenu(false);
                                                       }}
                                                       className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 text-gray-700"
                                                   >
                                                       <Download size={18} />
                                                       Backup erstellen
                                                   </button>
                                               )}
                                               <button
                                                   onClick={() => {
                                                       loadTimersFromFile();
                                                       setShowOptionsMenu(false);
                                                   }}
                                                   className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 text-gray-700"
                                               >
                                                   <Upload size={18} />
                                                   Backup laden
                                               </button>
                                           </div>
                                       </>
                                   )}
                               </div>
                           </div>
                       </div>

                       {/* Waschmaschinen-Timer */}
                       {washingMachineEndTime ? (
                           <div className={`mb-4 p-4 rounded-xl shadow-lg ${isWashingDone ? 'bg-green-500 animate-pulse' : 'bg-gradient-to-r from-purple-500 to-indigo-600'}`}>
                               <div className="flex items-center justify-between text-white">
                                   <div className="flex items-center gap-3">
                                       <div className="text-3xl">üß∫</div>
                                       <div>
                                           <div className="text-sm opacity-80">Waschmaschine</div>
                                           <div className="text-2xl font-bold font-mono">
                                               {isWashingDone ? 'Fertig!' : formatTime(washingRemaining)}
                                           </div>
                                       </div>
                                   </div>
                                   <button
                                       onClick={stopWashingMachine}
                                       className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg text-sm font-medium transition-colors"
                                   >
                                       {isWashingDone ? 'OK' : 'Stopp'}
                                   </button>
                               </div>
                               {!isWashingDone && (
                                   <div className="mt-3">
                                       <div className="w-full bg-white bg-opacity-20 rounded-full h-2">
                                           <div
                                               className="h-2 rounded-full bg-white transition-all duration-1000"
                                               style={{ width: `${Math.max(0, 100 - (washingRemaining / (170 * 60)) * 100)}%` }}
                                           />
                                       </div>
                                       <div className="text-xs text-white text-opacity-70 mt-1">
                                           Fertig um {washingMachineEndTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })} Uhr
                                       </div>
                                   </div>
                               )}
                           </div>
                       ) : (
                           <div className="mb-4 flex justify-end relative">
                               <div className="flex items-center">
                                   <button
                                       onClick={() => startWashingMachine(170)}
                                       className="text-gray-400 hover:text-purple-600 text-sm flex items-center gap-1 px-3 py-1 rounded-l-lg hover:bg-purple-50 transition-colors"
                                   >
                                       <span>üß∫</span>
                                       <span>2:50</span>
                                   </button>
                                   <button
                                       onClick={() => setShowWashingTimeSelect(!showWashingTimeSelect)}
                                       className="text-gray-400 hover:text-purple-600 text-sm px-1 py-1 rounded-r-lg hover:bg-purple-50 transition-colors border-l border-gray-200"
                                   >
                                       ‚ñº
                                   </button>
                               </div>
                               {showWashingTimeSelect && (
                                   <>
                                       <div className="fixed inset-0" onClick={() => setShowWashingTimeSelect(false)} />
                                       <div className="absolute top-8 right-0 bg-white rounded-lg shadow-xl border border-gray-200 py-2 min-w-40 z-50">
                                           <button onClick={() => startWashingMachine(60)} className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm">1:00</button>
                                           <button onClick={() => startWashingMachine(90)} className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm">1:30</button>
                                           <button onClick={() => startWashingMachine(120)} className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm">2:00</button>
                                           <button onClick={() => startWashingMachine(170)} className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm font-medium">2:50 (Standard)</button>
                                           <button onClick={() => startWashingMachine(180)} className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm">3:00</button>
                                           <div className="border-t border-gray-200 mt-1 pt-1 px-2">
                                               <div className="flex items-center gap-2 py-1">
                                                   <input
                                                       type="number"
                                                       min="1"
                                                       max="300"
                                                       value={customWashingMinutes}
                                                       onChange={(e) => setCustomWashingMinutes(parseInt(e.target.value) || 0)}
                                                       className="w-16 px-2 py-1 border rounded text-sm"
                                                       placeholder="Min"
                                                   />
                                                   <span className="text-xs text-gray-500">Min</span>
                                                   <button
                                                       onClick={() => startWashingMachine(customWashingMinutes)}
                                                       className="px-2 py-1 bg-purple-600 text-white rounded text-xs"
                                                   >
                                                       Start
                                                   </button>
                                               </div>
                                           </div>
                                       </div>
                                   </>
                               )}
                           </div>
                       )}

                       {/* Neue W√§scheladung hinzuf√ºgen */}
                       <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6">
                           <h2 className="text-lg sm:text-xl font-semibold mb-2 text-gray-800">Neue W√§scheladung</h2>
                           <div className="border-b border-gray-200 mb-4"></div>
                           <div className="flex flex-col gap-3 sm:flex-row">
                               <input
                                   type="text"
                                   value={newLoadName}
                                   onChange={(e) => setNewLoadName(e.target.value)}
                                   onKeyPress={(e) => e.key === 'Enter' && addNewLoad()}
                                   placeholder="z.B. Buntw√§sche, Handt√ºcher, Bettw√§sche..."
                                   className="flex-1 px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               />
                               <button
                                   onClick={addNewLoad}
                                   className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 transition-colors flex items-center justify-center gap-2 font-medium touch-target"
                               >
                                   <Plus size={20} />
                                   Starten
                               </button>
                           </div>
                       </div>


                       {/* Kompakte √úbersicht */}
                       {timers.length > 0 && (
                           <div className="bg-white rounded-lg shadow-md p-3 mb-4">
                               <div className="flex justify-between items-center text-center">
                                   <div className="flex-1">
                                       <div className="text-lg font-bold text-blue-600">
                                           {timers.length}
                                       </div>
                                       <div className="text-xs text-gray-600">Aktiv</div>
                                   </div>
                                   <div className="flex-1">
                                       <div className="text-lg font-bold text-green-600">
                                           {timers.filter(t => {
                                               const elapsed = Math.floor((currentTime.getTime() - t.startTime.getTime()) / 1000);
                                               return elapsed >= (3 * 24 * 60 * 60);
                                           }).length}
                                       </div>
                                       <div className="text-xs text-gray-600">Ziel erreicht</div>
                                   </div>
                               </div>
                           </div>
                       )}

                       {/* Timer-Liste */}
                       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                           {sortedTimers.map(timer => renderCompactTimer(timer))}
                       </div>

                       {timers.length === 0 && (
                           <div className="text-center py-12">
                               <Clock className="mx-auto text-gray-400 mb-4" size={64} />
                               <h3 className="text-xl font-semibold text-gray-600 mb-2">
                                   Noch keine W√§sche am Trocknen
                               </h3>
                               <p className="text-gray-500 px-4">
                                   F√ºgen Sie Ihre erste W√§scheladung hinzu, um mit dem Tracking zu beginnen.
                               </p>
                           </div>
                       )}

                   </div>
               </div>
           );
       };

       ReactDOM.render(<LaundryTimerApp />, document.getElementById('root'));

       if ('serviceWorker' in navigator) {
           navigator.serviceWorker.register('data:text/javascript,const CACHE_NAME="laundry-timer-v1";const urlsToCache=["/"];self.addEventListener("install",event=>{event.waitUntil(caches.open(CACHE_NAME).then(cache=>cache.addAll(urlsToCache)))});self.addEventListener("fetch",event=>{event.respondWith(caches.match(event.request).then(response=>{if(response){return response}return fetch(event.request)}))});')
               .then(registration => console.log('SW registered'))
               .catch(error => console.log('SW registration failed'));
       }
   </script>
</body>
</html>